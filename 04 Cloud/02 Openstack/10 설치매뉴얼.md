# Kolla Ansible Multinode로 설치하기 
## 개발 환경
controller  / Ram : 16G / Disk : 512G  / CPU : N100  
compute  / Ram : 32G / Disk : 512G / CPU : N100

OS : Ubuntu 24.04

## 설치 매뉴얼 
### Install dependencies
#### 1) Update Package index
```bash
sudo apt update
```
#### 2) Install Python build dependencies
```bash
sudo apt install git python3-dev libffi-dev gcc libssl-dev libdbus-glib-1-dev
```
### Install dependencies for the virtual environment
#### 3) Install the virtual environment dependencies
```bash 
sudo apt install python3-venv
```
#### 4) Create a virtual environment and activate it
```bash
python3 -m venv /path/to/venv
source /path/to/venv/bin/activate

# 필자는 ~/openstack 설치함
python3 -m venv ~/openstack/venv
source ~/openstack/venv/bin/activate
```

### Install Kolla-ansible
#### 1) Install kolla-ansible and its dependencies using pip.
```bash
pip install git+https://opendev.org/openstack/kolla-ansible@master
```

#### 2) Create the /etc/kolla directory.
```bash 
sudo mkdir -p /etc/kolla
sudo chown $USER:$USER /etc/kolla
```

#### 3) Copy globals.yml and passwords.yml to /etc/kolla directory.
```bash
cp -r /path/to/venv/share/kolla-ansible/etc_examples/kolla/* /etc/kolla
# 필자는 ~/openstack에 설치함
cp -r ~/openstack/venv/share/kolla-ansible/etc_examples/kolla/* /etc/kolla
```
#### 4) Copy all-in-one inventory file to the current directory.
```bash
cp /path/to/venv/share/kolla-ansible/ansible/inventory/multinode /etc/kolla/
# 필자는 ~/openstack에 설치함
cp ~/openstack/venv/share/kolla-ansible/ansible/inventory/multinode /etc/kolla/
```
### Install Ansible Galaxy requirements
#### 1) Install Ansible Galaxy dependencies
```bash 
kolla-ansible install-deps
```

### Prepare initial configuration
#### 1) Kolla passwords
```bash
kolla-genpwd
```

#### 2) Kolla globals.yml
제일 중요한 설정 1번 
```bash 
# docker에서 실행되는 os 설정
kolla_base_distro: "ubuntu" 

# openstack 설치 버전 설정
openstack_release: "2025.2"

# network interface 설정
network_interface: "eth0"

# 외부 네트워크 인터페이스 설정 openvswitch로 옮겨짐(물리 NIC -> 가상 NIC)
neutron_external_interface: "eth1"

# proxy IP 설정
kolla_internal_vip_address: "192.168.35.200"

# vswitch 설정 (openvswitch / ovn)
neutron_plugin_agent: "openvswitch"

# horizon 사용(openstack 대쉬보드)
enable_horizon: true
```

#### 3) multinode 설정
```bash
[all:vars]
ansible_ssh_common_args='-o StrictHostKeyChecking=no'

[control]
# These hostname must be resolvable from your deployment host
controller ansible_host=192.168.x.x ansible_user=root ansible_ssh_pass='pw' network_interface=enp1s0 api_interface=enp1s0

# The above can also be specified as follows:
#control[01:03]     ansible_user=kolla

# The network nodes are where your l3-agent and loadbalancers will run
# This can be the same as a host in the control group
[network]
controller

[compute]
compute01 ansible_host=192.168.x.x ansible_user=root ansible_ssh_pass='pw!' network_interface=enp3s0 api_interface=enp3s0

[monitoring]
```

### Deployment
```bash
kolla-ansible bootstrap-servers -i ./multinode
kolla-ansible prechecks -i ./multinode
kolla-ansible deploy -i ./multinode
```

### install Openstack CLI
```bash
pip install python-openstackclient -c https://releases.openstack.org/constraints/upper/master

kolla-ansible post-deploy
```
