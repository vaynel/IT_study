# Virtualization(가상화)

---

## 개요

**가상화(Virtualization)**는 컴퓨터의 물리적 리소스를 논리적으로 추상화하여 여러 개의 독립적인 실행 환경을 제공하는 기술입니다. 하나의 물리적 하드웨어에서 여러 운영체제나 애플리케이션을 동시에 실행할 수 있게 해줍니다.

### 특징

* **리소스 효율성**: 물리적 하드웨어를 더 효율적으로 활용
* **격리**: 각 가상 환경은 독립적으로 실행
* **유연성**: 빠른 프로비저닝 및 마이그레이션
* **비용 절감**: 하드웨어 투자 비용 감소
* **안정성**: 하나의 가상 머신 문제가 다른 환경에 영향 주지 않음

### 가상화의 역사

* 1960년대: IBM Mainframe에서 가상화 기술 시작
* 2000년대: x86 아키텍처에 가상화 기술 도입
* 현재: 클라우드 컴퓨팅의 기반 기술

---

## 가상화란?

가상화는 컴퓨터 리소스의 추상화를 일컫는 광범위한 용어입니다.

### 기본 개념

물리적 하드웨어(CPU, 메모리, 스토리지, 네트워크)를 논리적으로 분할하여 여러 개의 독립적인 환경을 만듭니다. 각 환경은 마치 독립적인 물리적 머신처럼 동작하지만, 실제로는 물리적 하드웨어를 공유합니다.

### 작동 원리

1. **하이퍼바이저(Hypervisor)**: 물리적 하드웨어와 가상 머신 사이의 중간 계층
2. **가상 머신(VM)**: 가상화된 하드웨어 위에서 실행되는 운영체제
3. **호스트(Host)**: 물리적 하드웨어와 하이퍼바이저가 실행되는 시스템
4. **게스트(Guest)**: 가상 머신 내에서 실행되는 운영체제

---

## 가상화의 종류

### 1. 서버 가상화 (Server Virtualization)

하나의 물리적 서버를 여러 개의 가상 서버로 분할합니다.

**장점**:
* 서버 통합으로 하드웨어 비용 절감
* 각 서버를 독립적으로 관리
* 리소스 활용률 향상

**사용 사례**:
* 웹 서버 호스팅
* 개발/테스트 환경
* 클라우드 인프라

### 2. 데스크톱 가상화 (Desktop Virtualization)

데스크톱 환경을 서버에서 실행하고 클라이언트는 원격으로 접근합니다.

**유형**:
* **VDI (Virtual Desktop Infrastructure)**: 각 사용자에게 전용 VM 제공
* **SBC (Server-Based Computing)**: 여러 사용자가 하나의 OS 세션 공유

**장점**:
* 중앙 집중식 관리
* 보안 강화
* 원격 접근 가능

**사용 사례**:
* 기업 내부 데스크톱 환경
* 원격 근무 환경
* 교육 기관

### 3. 네트워크 가상화 (Network Virtualization)

물리적 네트워크를 논리적으로 분할하거나 추상화합니다.

**기술**:
* **VLAN (Virtual LAN)**: 스위치를 논리적으로 분할
* **VPN (Virtual Private Network)**: 공용 네트워크 위에 가상 사설 네트워크
* **SDN (Software-Defined Networking)**: 네트워크 제어를 소프트웨어로

**장점**:
* 네트워크 리소스 효율적 활용
* 논리적 네트워크 분리
* 유연한 네트워크 구성

### 4. 스토리지 가상화 (Storage Virtualization)

여러 물리적 스토리지를 하나의 논리적 풀로 통합합니다.

**기술**:
* **SAN (Storage Area Network)**: 네트워크 기반 스토리지
* **NAS (Network Attached Storage)**: 네트워크 파일 시스템
* **Storage Pooling**: 여러 스토리지 장치를 하나로 통합

**장점**:
* 스토리지 관리 단순화
* 스토리지 활용률 향상
* 동적 할당 가능

### 5. 애플리케이션 가상화 (Application Virtualization)

애플리케이션을 호스트 OS에서 분리하여 독립적으로 실행합니다.

**기술**:
* **Container**: 컨테이너 기반 애플리케이션 패키징
* **Application Streaming**: 필요 시 애플리케이션 다운로드

**장점**:
* 애플리케이션 간 충돌 방지
* 빠른 배포
* 일관된 실행 환경

---

## 하이퍼바이저 (Hypervisor)

하이퍼바이저는 가상화를 가능하게 하는 핵심 소프트웨어입니다.

### Type 1: Bare-Metal (Native) Hypervisor

물리적 하드웨어 위에 직접 설치되는 하이퍼바이저입니다.

**특징**:
* 호스트 OS가 없음
* 성능 우수
* 엔터프라이즈 환경에 적합

**예시**:
* **VMware vSphere/ESXi**: 가장 널리 사용되는 엔터프라이즈 하이퍼바이저
* **Microsoft Hyper-V**: Windows 환경 통합
* **KVM (Kernel-based Virtual Machine)**: Linux 커널 기반
* **Citrix Hypervisor (XenServer)**: 오픈소스
* **Red Hat Virtualization**: RHEV (Red Hat Enterprise Virtualization)

**장점**:
* 높은 성능
* 낮은 오버헤드
* 엔터프라이즈 기능 제공

**단점**:
* 별도 라이선스 필요 (일부)
* 설정이 복잡함

### Type 2: Hosted Hypervisor

호스트 운영체제 위에서 실행되는 하이퍼바이저입니다.

**특징**:
* 일반 OS 위에서 애플리케이션처럼 실행
* 설정이 간단함
* 개발/테스트에 적합

**예시**:
* **VMware Workstation/Fusion**: 데스크톱 가상화
* **VirtualBox**: 오픈소스, 크로스 플랫폼
* **Parallels Desktop**: macOS용
* **QEMU**: 에뮬레이터

**장점**:
* 설치 및 사용이 간단
* 호스트 OS 기능 활용 가능
* 비용 효율적 (무료 옵션)

**단점**:
* 성능이 Type 1보다 낮음
* 호스트 OS의 오버헤드 존재

---

## 가상화 vs 컨테이너

| 특징 | 가상화 (VM) | 컨테이너 |
| ---- | ----------- | -------- |
| **격리 수준** | 하드웨어 레벨 격리 | OS 레벨 격리 |
| **오버헤드** | 높음 (Guest OS 필요) | 낮음 (Host OS 공유) |
| **시작 시간** | 분 단위 | 초 단위 |
| **리소스 사용** | 많음 (각 VM마다 OS) | 적음 (컨테이너만) |
| **이식성** | 중간 (하이퍼바이저 필요) | 높음 (어디서나 실행) |
| **보안** | 강함 (완전 격리) | 중간 (네임스페이스 기반) |
| **사용 사례** | 전체 OS 환경 | 애플리케이션 패키징 |

### 언제 무엇을 사용할가?

**가상화 (VM) 사용 시**:
* 다른 OS 실행 필요 (Windows, Linux 등)
* 강한 격리 필요
* 레거시 애플리케이션 실행
* 서로 다른 OS 커널 버전 필요

**컨테이너 사용 시**:
* 동일 OS 위에서 애플리케이션만 격리
* 빠른 배포와 스케일링 필요
* 마이크로서비스 아키텍처
* DevOps 워크플로우

**하이브리드 접근**:
* VM 안에 컨테이너 실행 (일반적)
* 컨테이너 오케스트레이션 (Kubernetes)이 VM 위에서 실행

---

## 가상화 기술의 핵심 요소

### 1. CPU 가상화

**전가상화 (Full Virtualization)**:
* 하이퍼바이저가 모든 하드웨어 명령어를 가로채서 변환
* Guest OS는 수정 없이 실행 가능
* 성능 오버헤드 있음

**반가상화 (Paravirtualization)**:
* Guest OS가 하이퍼바이저와 협력하여 실행
* Guest OS 커널 수정 필요
* 성능 향상

**하드웨어 지원 가상화**:
* Intel VT-x, AMD-V 기술 활용
* CPU 레벨에서 가상화 지원
* 성능 오버헤드 최소화

### 2. 메모리 가상화

**메모리 관리**:
* 각 VM에 물리적 메모리 할당
* 메모리 오버커밋: 할당된 총 메모리가 물리적 메모리보다 클 수 있음
* 메모리 공유: 같은 페이지는 공유 (Copy-on-Write)

**메모리 기술**:
* **Memory Ballooning**: 필요 시 메모리 반환
* **Memory Overcommitment**: 효율적 메모리 활용
* **Transparent Page Sharing**: 동일 페이지 공유

### 3. 스토리지 가상화

**스토리지 유형**:
* **Thick Provisioning**: 즉시 전체 용량 할당
* **Thin Provisioning**: 필요 시만 용량 할당
* **Deduplication**: 중복 데이터 제거

**스토리지 형식**:
* **VMDK** (VMware): VMware 가상 디스크
* **VHD/VHDX** (Hyper-V): Microsoft 가상 하드 디스크
* **QCOW2** (QEMU/KVM): 스냅샷 지원

### 4. 네트워크 가상화

**네트워크 구성**:
* **Bridge Mode**: 물리적 네트워크에 직접 연결
* **NAT Mode**: 네트워크 주소 변환
* **Host-Only**: 호스트 내부 통신만
* **Internal**: VM 간 통신만

**가상 네트워크**:
* **vSwitch**: 가상 스위치
* **VLAN**: 논리적 네트워크 분리
* **SDN**: 소프트웨어 정의 네트워킹

### 5. I/O 가상화

**I/O 처리**:
* 하이퍼바이저가 I/O 요청 가로채기
* 물리적 디바이스와 가상 디바이스 매핑
* I/O 성능 최적화

**SR-IOV (Single Root I/O Virtualization)**:
* 하드웨어 레벨에서 직접 I/O 할당
* 네트워크 성능 향상
* 고성능 워크로드에 적합

---

## 주요 가상화 솔루션

### VMware

**제품군**:
* **vSphere/ESXi**: 엔터프라이즈 서버 가상화
* **vCenter**: 중앙 관리 플랫폼
* **vSAN**: 소프트웨어 정의 스토리지
* **NSX**: 네트워크 가상화

**특징**:
* 가장 성숙한 엔터프라이즈 솔루션
* 강력한 관리 도구
* 광범위한 기능

### Microsoft Hyper-V

**특징**:
* Windows Server에 통합
* Windows 환경과 완벽 통합
* Active Directory 통합

**사용 사례**:
* Windows 중심 환경
* Microsoft 생태계

### KVM (Kernel-based Virtual Machine)

**특징**:
* Linux 커널에 통합
* 오픈소스
* 높은 성능

**사용 사례**:
* Linux 환경
* 오픈소스 기반 클라우드
* 비용 효율적 솔루션

### Citrix Hypervisor (XenServer)

**특징**:
* 오픈소스 기반
* Citrix 생태계와 통합
* VDI 솔루션과 함께 사용

### VirtualBox

**특징**:
* 오픈소스
* 크로스 플랫폼 (Windows, Linux, macOS)
* 개발/테스트에 적합

**사용 사례**:
* 데스크톱 가상화
* 개발 환경
* 개인 사용

---

## 가상화의 장점과 단점

### 장점

**비용 절감**:
* 하드웨어 통합으로 물리적 서버 수 감소
* 전력 및 냉각 비용 절감
* 공간 절약

**리소스 효율성**:
* 리소스 활용률 향상 (5-15% → 60-80%)
* 동적 리소스 할당
* 오버프로비저닝 감소

**유연성 및 확장성**:
* 빠른 프로비저닝 (시간 → 분 단위)
* VM 복제 및 템플릿 사용
* 유연한 리소스 조정

**안정성 및 가용성**:
* VM 격리로 장애 전파 방지
* Live Migration: 무중단 마이그레이션
* 고가용성 구성

**관리 편의성**:
* 중앙 집중식 관리
* 자동화 도구 활용
* 백업 및 복구 간소화

### 단점

**성능 오버헤드**:
* 하이퍼바이저 계층으로 인한 오버헤드
* I/O 성능 저하 가능
* CPU 집약적 작업에 영향

**복잡성**:
* 설정 및 관리가 복잡
* 전문 지식 필요
* 트러블슈팅 난이도 상승

**비용**:
* 하이퍼바이저 라이선스 비용 (일부)
* 관리 도구 비용
* 교육 비용

**보안**:
* 하이퍼바이저 취약점
* VM Escape 공격 가능성
* 네트워크 가상화 복잡성

**리소스 경합**:
* 물리적 리소스 공유로 인한 경합
* "Noisy Neighbor" 문제
* 성능 예측 어려움

---

## 가상화 사용 사례

### 1. 서버 통합 (Server Consolidation)

여러 물리적 서버를 하나의 물리적 서버로 통합합니다.

**효과**:
* 물리적 서버 수 10:1 ~ 20:1 통합
* 하드웨어 비용 50-70% 절감
* 관리 비용 감소

### 2. 개발/테스트 환경

개발자와 QA 팀에게 빠르게 환경을 제공합니다.

**장점**:
* 템플릿 기반 빠른 환경 생성
* 다양한 OS 환경 제공
* 쉽게 리셋 가능

### 3. 클라우드 컴퓨팅

IaaS (Infrastructure as a Service)의 기반 기술입니다.

**클라우드 제공자**:
* AWS EC2
* Azure Virtual Machines
* Google Compute Engine

### 4. 재해 복구 (Disaster Recovery)

재해 발생 시 빠르게 복구할 수 있습니다.

**기술**:
* VM 스냅샷 및 백업
* 복제 (Replication)
* 원격 사이트로 마이그레이션

### 5. 데스크톱 가상화 (VDI)

중앙 집중식 데스크톱 환경을 제공합니다.

**장점**:
* 중앙 관리
* 보안 강화
* 원격 접근

---

## 가상화 모범 사례

### 리소스 계획

**올바른 리소스 할당**:
* 실제 필요에 맞는 리소스 할당
* 과도한 리소스 할당 피하기
* 정기적인 모니터링 및 조정

**오버커밋 전략**:
* CPU: 적극적 오버커밋 가능 (200-300%)
* 메모리: 신중한 오버커밋 (120-150%)
* 스토리지: Thin Provisioning 활용

### 보안

**하이퍼바이저 보안**:
* 정기적인 업데이트 및 패치
* 최소 권한 원칙
* 네트워크 격리

**VM 보안**:
* 각 VM에 방화벽 구성
* 정기적인 백업
* 스냅샷 관리

### 모니터링 및 관리

**성능 모니터링**:
* CPU, 메모리, 디스크, 네트워크 사용량 추적
* 리소스 경합 식별
* 용량 계획

**자동화**:
* VM 프로비저닝 자동화
* 백업 자동화
* 패치 관리 자동화

### 백업 및 복구

**백업 전략**:
* 정기적인 VM 스냅샷
* 전체 VM 백업
* 애플리케이션 데이터 별도 백업

**복구 테스트**:
* 정기적인 복구 테스트
* RTO (Recovery Time Objective) 목표 설정
* RPO (Recovery Point Objective) 목표 설정

---

## 가상화와 클라우드

### IaaS (Infrastructure as a Service)

가상화 기술이 클라우드 IaaS의 기반입니다.

**특징**:
* 사용자가 VM 인스턴스를 요청
* 필요에 따라 생성 및 삭제
* 사용한 만큼 비용 지불 (Pay-as-you-go)

**제공자**:
* Amazon EC2
* Microsoft Azure Virtual Machines
* Google Cloud Compute Engine
* OpenStack (프라이빗 클라우드)

### 가상화의 역할

**리소스 추상화**:
* 물리적 하드웨어를 논리적 리소스 풀로 변환
* 동적 할당 및 재할당

**멀티 테넌시**:
* 여러 고객이 동일 물리적 인프라 공유
* 격리 보장

**자동화**:
* 자동 프로비저닝
* 자동 스케일링
* 자동 복구

---

## 학습 체크리스트

### 초급
- [ ] 가상화의 기본 개념 이해
- [ ] Type 1 vs Type 2 하이퍼바이저 차이
- [ ] 가상화 vs 컨테이너 차이
- [ ] VirtualBox 또는 VMware 설치 및 사용
- [ ] 기본 VM 생성 및 관리

### 중급
- [ ] 주요 하이퍼바이저 (VMware, Hyper-V, KVM) 특징 이해
- [ ] 가상화 아키텍처 이해 (CPU, 메모리, 스토리지, 네트워크)
- [ ] 리소스 할당 및 오버커밋 전략
- [ ] VM 스냅샷 및 백업
- [ ] 네트워크 구성 (Bridge, NAT, Host-Only)
- [ ] 성능 모니터링 및 최적화

### 고급
- [ ] 엔터프라이즈 가상화 플랫폼 운영 (vSphere, Hyper-V)
- [ ] Live Migration 구현
- [ ] 고가용성 구성
- [ ] 가상화 보안 모범 사례
- [ ] 자동화 및 오케스트레이션
- [ ] 클라우드 인프라 구축 (OpenStack)
- [ ] 컨테이너 가상화 (Docker, Kubernetes)

---

## 참고

* 가상화는 클라우드 컴퓨팅의 기반 기술입니다
* 올바른 리소스 계획과 모니터링이 중요합니다
* 보안을 고려한 가상화 구성이 필수입니다
* 정기적인 백업 및 복구 테스트를 수행하세요
