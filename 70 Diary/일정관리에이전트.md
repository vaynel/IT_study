
## 🛠️ 시스템 아키텍처 개요

이 시스템은 **Gemini(판단) - MCP(연결) - n8n(실행) - Notion(저장)**의 구조를 가집니다.

---

## 단계 1: 데이터 저장소 준비 (Notion)

먼저 에이전트가 정보를 읽고 쓸 데이터베이스가 필요합니다. 노션에서 새 데이터베이스를 생성하고 아래 필드를 정확히 설정하세요.

| 필드명 | 타입 | 용도 |
| --- | --- | --- |
| **태스크명** | Title | 할 일의 제목 |
| **일시** | Date | 시작 및 종료 시간 (알림의 기준점) |
| **상태** | Select | `대기`, `진행중`, `완료` |
| **상세 내용** | Text | Gemini가 기획한 세부 실행 가이드 |
| **알림 완료** | Checkbox | n8n이 알림을 보냈는지 여부 (중복 방지) |

---

## 단계 2: 실행 엔진 설정 (n8n)

Docker를 사용 중이시므로, n8n을 외부(Gemini)에서 호출할 수 있도록 설정해야 합니다.

### 1. n8n 설치 및 외부 노출

n8n이 이미 설치되어 있다면, **Cloudflare Tunnel**이나 **Nginx Proxy Manager**를 통해 Webhook URL이 외부에서 접근 가능한지 확인하세요.

### 2. 입력 Webhook 워크플로우 구성

n8n에서 새로운 워크플로우를 생성하고 다음 노드를 배치합니다.

1. **Webhook Node:** HTTP Method를 `POST`로 설정하고 경로를 `/v1/schedule`로 지정합니다.
2. **Notion Node:** Webhook에서 받은 데이터를 Notion DB에 `Create Item`으로 연결합니다.
* `Title`  `{body.title}`
* `Date`  `{body.start_time}`


3. **Respond to Webhook Node:** 성공 메시지(`{"status": "success"}`)를 반환합니다.

---

## 단계 3: Gemini MCP 연동 (CLI 환경)

Gemini CLI(또는 Google AI Studio 기반 에이전트)가 n8n을 '도구'로 인식하게 만드는 단계입니다.

### 1. MCP 서버 설정

`gemini_mcp_config.json` 파일을 생성하여 n8n의 기능을 정의합니다. (가장 간단한 방식은 Webhook 호출 도구를 정의하는 것입니다.)

```json
{
  "mcpServers": {
    "n8n_agent": {
      "command": "npx",
      "args": ["-y", "@n8n/mcp-server-n8n"],
      "env": {
        "N8N_API_KEY": "YOUR_N8N_API_KEY",
        "N8N_BASE_URL": "https://your-n8n-domain.com"
      }
    }
  }
}

```

### 2. 에이전트 페르소나 설정 (System Prompt)

Gemini에게 다음과 같은 역할을 부여합니다.

> "너는 일정 관리 전문 에이전트야. 사용자의 요청을 분석하여 태스크를 분할하고, 적절한 시간을 계산해. 결정된 일정은 `n8n_agent` 도구를 사용해 노션에 등록해."

---

## 단계 4: 자동 알림 루프 구축 (n8n)

일정이 되었을 때 나를 찔러주는 'Watchdog' 워크플로우를 별도로 만듭니다.

1. **Schedule Trigger:** 1분마다 실행되도록 설정합니다.
2. **Notion Node (List):** * 조건: `일시`가 현재 시간 이전이고, `알림 완료`가 `False`인 항목 검색.
3. **Google Chat Node:** 검색된 항목이 있다면 메시지를 발송합니다.
* 메시지 예시: "🔔 **지금 시작하세요:** {{제목}} (상세: {{상세 내용}})"


4. **Notion Node (Update):** 해당 항목의 `알림 완료`를 `True`로 업데이트합니다.

---

## 📄 시스템 운영 문서 (Summary)

### 1. 일상적인 사용 (Mobile / CLI)

* **명령:** "오늘 오후 4시에 OpenStack 네트워크 트러블슈팅 1시간 잡아줘."
* **에이전트 동작:** 1.  현재 시간을 확인하고 오후 4시를 ISO 8601 포맷으로 변환.
2.  n8n MCP를 호출하여 노션에 데이터 전송.
3.  "오후 4시에 일정을 등록했습니다."라고 답변.

### 2. 유지보수 가이드

* **로그 확인:** n8n의 `Execution History`를 통해 데이터 전달 오류 확인.
* **시간대 확인:** 서버(Docker)와 Notion, Gemini의 Timezone이 모두 `Asia/Seoul`로 일치하는지 확인.
* **보안:** n8n API Key와 Webhook URL이 외부에 노출되지 않도록 관리.

---

이제 첫 번째 단계로 **노션 데이터베이스를 생성**하고 알려주시면, 그에 딱 맞는 **n8n 워크플로우 JSON 파일**을 짜 드릴 수 있습니다. 준비되셨나요?

**다음 단계로 무엇을 도와드릴까요?**

1. n8n 워크플로우(JSON) 코드 작성
2. Cloudflare Tunnel을 이용한 n8n 외부 노출 가이드
3. Gemini CLI 설치 및 MCP 설정 상세 가이드